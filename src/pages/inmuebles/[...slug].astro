---
import Layout from "@/layouts/Layout.astro";
import { IoIosPricetag, IoIosHome, IoIosBed } from "react-icons/io";
import {
  FaBath,
  FaRuler,
  FaParking,
  FaArrowAltCircleLeft,
} from "react-icons/fa";
import { formatearCOP } from "@/utils";
import { Image } from "astro:assets";
import type { CollectionEntry } from "astro:content";
import { getCollection } from "astro:content";
import { fade } from "astro:transitions";

export async function getStaticPaths() {
  const entradasInmuebles: CollectionEntry<"inmuebles">[] =
    await getCollection("inmuebles");
  return entradasInmuebles.map((entrada) => ({
    params: { slug: entrada.id.replace(/\.[^/.]+$/, "") },
    props: { entrada },
  }));
}

const { entrada } = Astro.props;
const { data } = entrada;

// Array para iterar los detalles y evitar repetición de código
const detalles = [
  {
    icon: IoIosPricetag,
    label: "Precio",
    value: formatearCOP(data.precio),
    primary: true,
  },
  { icon: IoIosHome, label: "Barrio", value: data.barrio },
  { icon: IoIosBed, label: "Habitaciones", value: data.habitaciones },
  { icon: FaBath, label: "Baños", value: data.baños },
  { icon: FaRuler, label: "Área", value: `${data.area} m²` },
  { icon: FaParking, label: "Parking", value: data.parqueadero ? "Sí" : "No" },
];
---

<Layout titulo={`Smart House - ${data.titulo}`} descripcion={data.titulo}>
  <section
    class="max-w-6xl mx-auto px-4 py-8"
    transition:animate={fade({ duration: "0.4s" })}
  >
    <header class="mb-8 text-center">
      <h1
        class="text-4xl md:text-6xl font-mono font-black uppercase tracking-tighter text-base-content"
      >
        {data.titulo}
      </h1>
      <div class="h-1.5 w-24 bg-warning mx-auto mt-4 rounded-full"></div>
    </header>

    <div
      class="relative group overflow-hidden rounded-3xl shadow-2xl mb-12 border border-base-300"
    >
      <Image
        src={data.imagen}
        alt={data.titulo}
        width={1200}
        height={600}
        class="w-full aspect-video object-cover transition-transform duration-500 delay-300 ease-in-out hover:brightness-105"
        loading="lazy"
        data-aos="fade-up"
      />
      <div
        class="absolute inset-0 bg-black/20 group-hover:bg-transparent transition-colors duration-700 pointer-events-none"
      >
      </div>
    </div>

    <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <aside class="lg:col-span-1">
        <div
          class="card bg-base-200 shadow-xl sticky top-8 border border-base-300"
          data-aos="fade-right"
        >
          <div class="card-body p-6">
            <h2 class="card-title text-xl mb-4 border-b pb-2">
              Especificaciones
            </h2>
            <div class="space-y-4">
              {
                detalles.map((item) => (
                  <div class="flex items-center justify-between group">
                    <div class="flex items-center gap-3">
                      <span
                        class={`p-2 rounded-lg ${item.primary ? "bg-warning text-white" : "bg-base-300 text-base-content group-hover:bg-warning/20 transition-colors"}`}
                      >
                        <item.icon className="text-xl" />
                      </span>
                      <span class="text-sm font-medium opacity-70">
                        {item.label}
                      </span>
                    </div>
                    <span
                      class={`font-bold ${item.primary ? "text-warning text-xl" : "text-base-content"}`}
                    >
                      {item.value}
                    </span>
                  </div>
                ))
              }
            </div>
          </div>
        </div>
      </aside>

      <article class="lg:col-span-2 space-y-8" data-aos="fade-left">
        <div
          class="prose prose-lg max-w-none text-base-content/80 leading-relaxed"
        >
          <h2 class="text-3xl font-bold text-base-content mb-4">
            Descripción del Inmueble
          </h2>
          <p class="whitespace-pre-line">
            {entrada.body}
          </p>
        </div>

        <div class="pt-8">
          <a
            href="/#propiedades"
            class="btn btn-warning btn-lg w-full md:w-auto gap-4 rounded-2xl shadow-lg hover:shadow-primary/20"
          >
            <FaArrowAltCircleLeft className="text-2xl" />
            Volver a propiedades
          </a>
        </div>
      </article>
    </main>
  </section>
</Layout>

<style>
  /* Opcional: Para mejorar la legibilidad del body si viene con saltos de línea */
  .whitespace-pre-line {
    white-space: pre-line;
  }
</style>
